<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset=utf-8>
        <meta name="robots" content="noindex, nofollow">

        <title>Settings | AxS</title>

        <link rel="shortcut icon" href="./resources/images/favicon.ico" type="image/x-icon" />
        <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" />
        <link href="./resources/css/style.css" rel="stylesheet" />
        <!-- <link rel="shortcut icon" type="image/png" href="./resources/favicon.png"/> -->
    </head>

    <body>
        <div class=container>
            <div class=sideBar>
                <div class=sb-header>
                    <div class=sb-header-img></div>
            
                    <div class=sb-header-text>
                        AxS calculator
                        <hr />
                        <a href="./settings.html" class="btn btn-sb-menu btn-xs" title="Settings"><i class="fas fa-cogs"></i></a> 
                    </div>
                </div>
            
                <div class=sb-navigation>
                    <a href="./index.html" class="sb-nav-column"><i class="fas fa-info"></i> Information</a>
                    <a href="./lobbyoverview.html" class="sb-nav-column"><i class="fas fa-bars"></i> Lobby overview</a>
                    <a href="./createlobby.html" class="sb-nav-column"><i class="far fa-plus-square"></i> Create a lobby</a>
                    <a href="./modifiers.html" class="sb-nav-column"><i class="far fa-times-circle"></i> Modifiers</a>
                </div>
            </div>

            <div class=mainContent>
                <div class=row>
                    <div class=col-12>
                        <div class=form-group>
                            <h2>API key</h2>
                            <p>Enter your osu!API key so the application is able to grab all relevant information (multiplayer, beatmap, user information). <br />The API key can be found <a href="https://osu.ppy.sh/p/api">here</a>.</p>
                            <input id=apiKey type=password class=form-control placeholder="osu!API key" />
                        </div>

                        <div id=message></div>

                        <button id=saveButton type="button" class="btn btn-primary float-right">Save</button>
                    </div>
                </div>

                <hr />

                <div class=row>
                    <div class=col-12>
                        <div class=row>
                            <div class=col-7>
                                This will export the config file and save it as a file in case you need to share it with someone. <br />
                                <b>Note:</b> It will not export the API key in the file <br />

                                <textarea id="exportedConfigFile" class="form-control" rows="5"></textarea>
                                <br />

                                <button id="exportConfigFile" type="button" class="btn btn-primary">Export config file</button>
                            </div>
                        </div>

                        <hr />

                        <div class=row>
                            <div class=col-7>
                                This will clear all the cache. <br />

                                <div id="clearCacheMessage" class="alert alert-success no-show">Succesfully cleared the cache.</div>

                                <button id="clearCache" type="button" class="btn btn-primary">Clear cache</button>
                            </div>
                        </div>

                        <hr />

                        <div class=row>
                            <div class=col-7>
                                This will remove the API key. <br />

                                <div id="removeApiKeyMessage" class="alert alert-success no-show">Succesfully removed the API key.</div>

                                <button id="removeApiKey" type="button" class="btn btn-primary">Remove API key</button>
                            </div>
                        </div>

                        <hr />
                    </div>
                </div>
            </div>
        </div>
    </body>

    <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
    <script src="./resources/js/jquery-3.3.1.min.js"></script>
    <script src="./resources/js/bootstrap.min.js"></script>
    <script src="./resources/js/functions.js"></script>
    <script>if (window.module) module = window.module;</script>

    <script>
        const {ipcRenderer, remote} = require('electron');

        $(() => {
            $('#saveButton').on('click', function() {
                $('#saveButton').html('Save <i class="fas fa-spinner fa-spin"></i>');
                ipcRenderer.send('saveAPIKey', $('#apiKey').val());
            });

            // This is called when the data has been saved
            ipcRenderer.on('savedData', (event, arg) => {
                $('#saveButton').html('Save');
                $('#message').html(`<div class="alert alert-success col-7"><h2><i class="fas fa-check"></i> Success!</h2>Succesfully saved your API key.</div>`);
            });

            // Request the api key
            ipcRenderer.send('requestAPIKey', true);

            // The api key that you requested
            ipcRenderer.on('requestedAPIKey', (event, apiKey) => {
                $('#apiKey').val(apiKey);
            });

            // When an error is returned
            ipcRenderer.on('errorMessage', (event, errorMessage) => {
                $('#saveButton').html('Save');
                $('#message').html(`<div class="alert alert-danger col-7"><h2><i class="fas fa-exclamation-triangle"></i> Error</h2> ${errorMessage}</div>`);
            });

            $('#exportConfigFile').on('click', function() {
                // Send a request to export the config file
                ipcRenderer.send('exportConfigFile', true);
            });

            ipcRenderer.on('exportedConfigFile', (event, arg) => {
                $('#exportedConfigFile').html(JSON.stringify(arg, null, '\t'));
            });

            $('#clearCache').on('click', function() {
                // send a request to clear the cache
                ipcRenderer.send('clearCache', true);
            });

            // When the cache has been cleared
            ipcRenderer.on('clearedCache', (event, arg) => {
                $('#clearCacheMessage').removeClass('no-show');
            });

            $('#removeApiKey').on('click', function() {
                // send a request to remove the api key
                ipcRenderer.send('removeApiKey', true);
            });

            // When the cache has been cleared
            ipcRenderer.on('removedApiKey', (event, arg) => {
                $('#removeApiKeyMessage').removeClass('no-show');
            });
        });

        // Open urls in the actual browser and not within the application
        $('body').on('click', '.mainContent a', (e) => {
            e.preventDefault();
            require("electron").shell.openExternal(e.target.href);
        });
    </script>
</html>